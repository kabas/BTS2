"use strict";function DialogController(a,b,c,d,e,f,g,h){a.currentStopName=c,a.currentStopType=e,h&&(a.Route=h,a.routeColor="OUTER LOOP"===h?"#03A9F4":"INNER LOOP"===h?"#e8721f":"UPPER CAMPUS"===h?"#FFEB3B":"NIGHT OWL"===h?"#009688":"LOOP OUT OF SERVICE AT BARN THEATER"===h||"OUT OF SERVICE/SORRY"===h?"#F44336":"#607D8B"),a.photo="images/stopPhotos/"+e+c+"/"+d+".jpg",a.stopPreview={background:"url("+a.photo+")"},a.hide=function(){b.hide()},a.showStreetView=function(){var b={"OuterMcLaughlin & Science Hill":{lat:36.999935,lng:-122.062135,head:296.89,pitch:0},"OuterHeller & Kresge College":{lat:36.999241,lng:-122.064452,head:270.54,pitch:-10},"OuterMcLaughlin & College 9 & 10 - Health Center":{lat:36.999856,lng:-122.058251,head:339.05,pitch:5},"OuterMcLaughlin & Crown College":{lat:36.998954,lng:-122.055286,head:40.62,pitch:-5},"OuterHagar & Bookstore-Stevenson College":{lat:36.997219,lng:-122.055263,head:57.52,pitch:5},"OuterHagar & Field House East":{lat:36.994269,lng:-122.055624,head:69.66,pitch:-5},"OuterHagar & East Remote":{lat:36.991304,lng:-122.054784,head:92.8,pitch:-5},"OuterHagar & Lower Quarry Rd":{lat:36.985984,lng:-122.053706,head:101.89,pitch:0},"OuterCoolidge & Hagar":{lat:36.981484,lng:-122.051999,head:180.41,pitch:-5},"OuterCoolidge & Main Entrance":{lat:36.977468,lng:-122.053582,head:28.03,pitch:-5},"OuterHigh & Western Dr":{lat:36.978694,lng:-122.057741,head:259.02,pitch:-5},"OuterEmpire Grade & Tosca Terrace":{lat:36.97984,lng:-122.059084,head:209.46,pitch:-5},"OuterEmpire Grade & Arboretum":{lat:36.983755,lng:-122.064933,head:181.41,pitch:0},"OuterHeller & Oakes College":{lat:36.989899,lng:-122.067078,head:282.16,pitch:-5},"OuterHeller & Family Student Housing":{lat:36.991905,lng:-122.066699,head:216.25,pitch:5},"OuterHeller & College 8 & Porter":{lat:36.992896,lng:-122.065127,head:349.44,pitch:5},"InnerHeller & Kerr Hall":{lat:36.996805,lng:-122.063655,head:40.17,pitch:-5},"InnerHeller & Kresge College":{lat:36.99911,lng:-122.064476,head:84.33,pitch:-10},"InnerMcLaughlin & Science Hill":{lat:36.999935,lng:-122.062135,head:142.31,pitch:-10},"InnerMcLaughlin & College 9 & 10 - Health Center":{lat:36.999845,lng:-122.05824,head:181.55,pitch:-5},"InnerHagar & Bookstore":{lat:36.996823,lng:-122.055366,head:212.14,pitch:-10},"InnerHagar & East Remote":{lat:36.991469,lng:-122.054875,head:201.42,pitch:-10},"InnerHagar & Lower Quarry Rd":{lat:36.985671,lng:-122.053489,head:203.61,pitch:-5},"InnerCoolidge & Hagar":{lat:36.981457,lng:-122.052044,head:334.96,pitch:5},"InnerHigh & Western Dr":{lat:36.978641,lng:-122.057663,head:5.51,pitch:-5},"InnerHigh & Barn Theater":{lat:36.977237,lng:-122.054173,head:321.62,pitch:-5},"InnerEmpire Grade & Arboretum":{lat:36.982496,lng:-122.062425,head:351.79,pitch:-5},"InnerHeller & Oakes College":{lat:36.99052,lng:-122.066254,head:78.52,pitch:5},"InnerHeller & College 8 & Porter":{lat:36.992894,lng:-122.064712,head:217.81,pitch:-5}};a.hide(),a.sv=new google.maps.StreetViewPanorama(document.getElementById("map"),{addressControlOptions:{position:7},enableCloseButton:!0,panControlOptions:{position:7},zoomControl:!1,linksControl:!1,position:new google.maps.LatLng(b[a.currentStopType+a.currentStopName].lat,b[a.currentStopType+a.currentStopName].lng),pov:{heading:b[a.currentStopType+a.currentStopName].head,pitch:b[a.currentStopType+a.currentStopName].pitch},visible:!0})}}var btsModule=angular.module("BTS2App",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","uiGmapgoogle-maps","ngMaterial","ngMdIcons"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]);btsModule.config(["uiGmapGoogleMapApiProvider",function(a){a.configure({key:"AIzaSyDartvWxBRwtQW213XfzXBPSuBn-vn-c1E",v:"3.17",libraries:"weather,geometry,visualization"})}]),angular.module("BTS2App").controller("MainCtrl",["$scope",function(a){a.createMarker=function(a){var b={};if(b.id=a.id,b.latitude=a.latitude,b.route=a.route,b.longitude=a.longitude,b.zIndex=10,"LOOP"===a.route){var c,d,e=0;a.predictions=a.predictions.split(","),c=-1;for(var f=a.predictions.length-1;f>=0;f--)if(a.predictions[f]){if(d=a.predictions[f],c>d&&e++,e>3)return b.icon={url:"../../images/shuttleIcons/routeILoop_30.png",anchor:new google.maps.Point(15,15),origin:new google.maps.Point(0,0)},b.route="INNER LOOP",b;c=d}b.icon={url:"../../images/shuttleIcons/routeOLoop_30.png",anchor:new google.maps.Point(15,15),origin:new google.maps.Point(0,0)},b.route="OUTER LOOP"}else b.icon="UPPER CAMPUS"===a.route?{url:"../../images/shuttleIcons/routeuc_30.png",anchor:new google.maps.Point(15,15),origin:new google.maps.Point(0,0)}:"NIGHT OWL"===a.route?{url:"../../images/shuttleIcons/routeno_30.png",anchor:new google.maps.Point(15,15),origin:new google.maps.Point(0,0)}:"LOOP OUT OF SERVICE AT BARN THEATER"===a.route||"OUT OF SERVICE/SORRY"===a.route?{url:"../../images/shuttleIcons/routeos_30.png",anchor:new google.maps.Point(15,15),origin:new google.maps.Point(0,0)}:{url:"../../images/shuttleIcons/routesp_30.png",anchor:new google.maps.Point(15,15),origin:new google.maps.Point(0,0)};return b},a.updateMarker=function(a,b){return a.latitude=b.latitude,a.longitude=b.longitude,a},a.updateIOSScreenSize=function(){if(navigator.userAgent.match(/iPad;.*CPU.*OS 7_\d/i)&&window.innerHeight!=document.documentElement.clientHeight){var a=function(){document.documentElement.style.height=window.innerHeight+"px",0!==document.body.scrollTop&&window.scrollTo(0,0)};window.addEventListener("scroll",a,!1),window.addEventListener("orientationchange",a,!1),a(),document.body.style.webkitTransform="translate3d(0,0,0)"}navigator.userAgent.match(/iPad;.*CPU.*OS 7_\d/i)&&$("html").addClass("ipad ios7")}}]),angular.module("BTS2App").controller("MapCtrl",["$rootScope","$scope","$http","$timeout","$window","$log","uiGmapGoogleMapApi","$mdDialog","$mdSidenav",function(a,b,c,d,e,f,g,h,i){var j=[];b.animateTimeout=0,a.busCount=0,a.noBusMessage=!1,b.returnToTab=!1,a.notMobile=e.innerWidth>1024?!0:!1,b.close=function(){i("left").close().then(function(){}),a.toggleLeftButton(),a.showPanel=!1},b.openNav=function(){i("left").open().then(function(){}),a.showPanel=!0,a.toggleLeftButton()},b.map={id:1,center:{latitude:36.990282103105066,longitude:-122.06149578094482},markers:[],busInnerStops:[],busOuterStops:[],busStops:[],zoom:a.notMobile?15:14,options:{streetViewControl:!0,streetViewControlOptions:{position:7},panControl:!0,panControlOptions:{position:7},zoomControl:!0,zoomControlOptions:{style:2,position:7},scaleControl:!0,scaleControlOptions:{position:7}},events:{}},b.markerIDs=[],g.then(function(a){b.maps=a,m(),k()});var k=function(){var c=function(a,c){var d,e,f=0,g=100,h=5,i=0,j=function(){0!==b.map.markers.length&&(b.map.markers[a].latitude+=d,b.map.markers[a].longitude+=e,_.defer(function(){b.$apply()}),i!==g&&(i++,b.animateTimeout=setTimeout(j,h)))};(b.map.markers[a].latitude!==c.latitude||b.map.markers[a].longitude!==c.longitude)&&(d=(c.latitude-b.map.markers[a].latitude)/g,e=(c.longitude-b.map.markers[a].longitude)/g,0!==d&&0!==e&&j(),f=1)};$.ajax({url:"http://skynet.soe.ucsc.edu/bts/coord2.jsonp",dataType:"jsonp",jsonp:!0,cache:!1,jsonpCallback:"parseResponse",success:function(f){console.log(f),a.busCount=f.count,0!==a.busCount||b.noBusMessage||b.showNoBuses();for(var g,h=f.count-1;h>=0;h--){g=!0;for(var i=b.markerIDs.length-1;i>=0;i--)b.markerIDs[i]===f.markers[h].id&&(g=!1);g&&(b.map.markers.push(b.createMarker(f.markers[h])),b.markerIDs.push(f.markers[h].id))}for(var m,n=b.map.markers.length-1;n>=0;n--){m=!0;for(var o=f.count-1;o>=0;o--)b.map.markers[n].id===f.markers[o].id&&(m=!1);if(m===!0){for(var p=b.markerIDs.length-1;p>=0;p--)b.markerIDs[p]===b.map.markers[n].id&&b.markerIDs.splice(p,1);b.map.markers.splice(n,1)}}for(var q=b.map.markers.length-1;q>=0;q--)for(var r=f.count-1;r>=0;r--)b.map.markers[q].id===f.markers[r].id&&(a.notMobile?c(q,f.markers[r]):(b.map.markers[q].latitude=f.markers[r].latitude,b.map.markers[q].longitude=f.markers[r].longitude));_.each(b.map.markers,function(a){a.closeClick=function(){_.defer(function(){b.$apply()})},a.onClicked=function(){b.map.center={latitude:a.latitude,longitude:a.longitude},l(a)}}),j.push(d(k,3e3)),e.onblur=function(){for(var a=j.length-1;a>=0;a--)d.cancel(j[a]);j.splice(0,j.length),d.cancel(b.animateTimeout),b.map.markers.splice(0,b.map.markers.length),b.markerIDs.splice(0,b.markerIDs.length)},e.onfocus=function(){k()}}})},l=function(a){b.currBus=a.route,b.showRoute()},m=function(){for(var a=[[5,36.9999313354492,-122.062049865723,"McLaughlin & Science Hill"],[2,36.9967041015625,-122.063583374023,"Heller & Kerr Hall"],[3,36.999210357666,-122.064338684082,"Heller & Kresge College"],[5,36.9999313354492,-122.062049865723,"McLaughlin & Science Hill"],[6,36.9997062683105,-122.05834197998,"McLaughlin & College 9 & 10 - Health Center"],[10,36.9966621398926,-122.055480957031,"Hagar & Bookstore"],[13,36.9912567138672,-122.054962158203,"Hagar & East Remote"],[15,36.985523223877,-122.053588867188,"Hagar & Lower Quarry Rd"],[17,36.9815368652344,-122.052131652832,"Coolidge & Hagar"],[18,36.9787902832031,-122.057762145996,"High & Western Dr"],[20,36.9773025512695,-122.054328918457,"High & Barn Theater"],[23,36.9826698303223,-122.062492370605,"Empire Grade & Arboretum"],[26,36.9905776977539,-122.066116333008,"Heller & Oakes College"],[29,36.9927787780762,-122.064880371094,"Heller & College 8 & Porter"]],c=a.length-1;c>=0;c--)b.map.busInnerStops.push({id:a[c][0],loopType:"Inner",icon:{url:"../../images/InnerLoopStop_small.5455dc67.png",anchor:new google.maps.Point(5,5),origin:new google.maps.Point(0,0)},latitude:a[c][1],longitude:a[c][2],showWindow:!1,stopName:a[c][3]});_.each(b.map.busInnerStops,function(a){a.closeClick=function(){a.showWindow=!1,_.defer(function(){b.$apply()})},a.onClicked=function(){n(a)}});for(var d=[[1,36.9992790222168,-122.064552307129,"Heller & Kresge College"],[4,37.0000228881836,-122.062339782715,"McLaughlin & Science Hill"],[7,36.9999389648438,-122.058349609375,"McLaughlin & College 9 & 10 - Health Center"],[8,36.9990234375,-122.055229187012,"McLaughlin & Crown College"],[9,36.9974822998047,-122.055030822754,"Hagar & Bookstore-Stevenson College"],[11,36.9942474365234,-122.055511474609,"Hagar & Field House East"],[12,36.9912986755371,-122.054656982422,"Hagar & East Remote"],[14,36.985912322998,-122.053520202637,"Hagar & Lower Quarry Rd"],[16,36.9813537597656,-122.051971435547,"Coolidge & Hagar"],[19,36.9776763916016,-122.053558349609,"Coolidge & Main Entrance"],[21,36.9786148071289,-122.05785369873,"High & Western Dr"],[22,36.9798469543457,-122.059257507324,"Empire Grade & Tosca Terrace"],[24,36.9836616516113,-122.064964294434,"Empire Grade & Arboretum"],[25,36.989917755127,-122.067230224609,"Heller & Oakes College"],[27,36.991828918457,-122.066833496094,"Heller & Family Student Housing"],[28,36.992977142334,-122.065223693848,"Heller & College 8 & Porter"]],c=d.length-1;c>=0;c--){{d[c][3]}b.map.busOuterStops.push({id:d[c][0],loopType:"Outer",icon:{url:"../../images/OuterLoopStop_small.8e126107.png",anchor:new google.maps.Point(5,5),origin:new google.maps.Point(0,0)},zIndex:3,latitude:d[c][1],longitude:d[c][2],showWindow:!1,stopName:d[c][3]})}_.each(b.map.busOuterStops,function(a){a.closeClick=function(){a.showWindow=!1,_.defer(function(){b.$apply()})},a.onClicked=function(){n(a)}})},n=function(a){b.currentStopName=a.stopName,b.currentStopId=a.id,b.currentStopType=a.loopType,b.showStop()};b.showStop=function(a){h.show({clickOutsideToClose:!0,controller:DialogController,templateUrl:"../../views/stopDialog.html",targetEvent:a,locals:{stop:b.currentStopName,id:b.currentStopId,type:b.currentStopType,map:b.map,maps:b.maps,marker:b.currBus}}).then(function(){},function(){})},b.showNoBuses=function(a){b.noBusMessage=!0,h.show({clickOutsideToClose:!0,controller:DialogController,templateUrl:"../../views/nobusDialog.html",targetEvent:a,locals:{stop:b.currentStopName,id:b.currentStopId,type:b.currentStopType,map:b.map,maps:b.maps,marker:b.currBus}}).then(function(){},function(){})},b.showMobileApp=function(a){h.show({clickOutsideToClose:!0,controller:["$scope","$mdDialog",DialogController],templateUrl:"../../views/mobileDialog.html",targetEvent:a,locals:{stop:b.currentStopName,id:b.currentStopId,type:b.currentStopType,map:b.map,maps:b.maps,marker:b.currBus}}).then(function(){},function(){})},b.showRoute=function(a){h.show({clickOutsideToClose:!0,controller:DialogController,templateUrl:"../../views/routeDialog.html",targetEvent:a,locals:{stop:b.currentStopName,id:b.currentStopId,type:b.currentStopType,map:b.map,maps:b.maps,marker:b.currBus}}).then(function(){},function(){})},b.showTestDialog=function(c){h.show({clickOutsideToClose:!0,controller:DialogController,templateUrl:"../../views/testDialog.html",targetEvent:c,locals:{stop:b.currentStopName,id:b.currentStopId,type:b.currentStopType,map:b.map,maps:b.maps,marker:b.currBus}}).then(function(){a.notMobile||(b.updateIOSScreenSize(),b.copyright="copyrightMobile")},function(){})},b.showTestDialog()}]),angular.module("BTS2App").controller("PanelCtrl",["$rootScope","$scope","$timeout","$mdSidenav","$mdUtil",function(a,b,c,d,e){a.showPanel=!0,b.toggleLeft(),b.oneAtATime=!0,b.close=function(){d("left").close().then(function(){}),a.showPanel=!1,d("navButton").isOpen()||a.toggleLeftButton()}}]),DialogController.$inject=["$scope","$mdDialog","stop","id","type","map","maps","marker"],angular.module("BTS2App").controller("DialogController",["$scope","$mdDialog","stop","id","type","map","maps","marker",DialogController]);